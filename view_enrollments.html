<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>View Enrollments</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .search-container {
      margin: 30px 0;
      text-align: center;
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .search-input {
      padding: 12px 20px;
      width: 350px;
      max-width: 100%;
      border: 2px solid #e9ecef;
      border-radius: 25px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
    }
    
    .search-btn {
      padding: 12px 25px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin: 0 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .search-btn.show-all {
      background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
      box-shadow: 0 4px 15px rgba(67, 206, 162, 0.3);
    }
    
    .search-btn.show-all:hover {
      box-shadow: 0 8px 25px rgba(67, 206, 162, 0.4);
    }
    
    .enrollments-container {
      margin-top: 30px;
    }
    
    .student-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      border-left: 5px solid #667eea;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .student-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2, #43cea2, #185a9d);
      background-size: 400% 400%;
      animation: gradientShift 3s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .student-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    
    .student-info {
      margin-bottom: 20px;
      border-bottom: 2px solid #f8f9fa;
      padding-bottom: 15px;
    }
    
    .student-name {
      font-size: 22px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .student-details {
      color: #666;
      font-size: 15px;
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .clubs-section {
      margin-top: 15px;
    }
    
    .clubs-title {
      font-size: 16px;
      font-weight: bold;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .clubs-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .club-tag {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .club-tag:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .no-results {
      text-align: center;
      color: #666;
      font-size: 18px;
      font-style: italic;
      margin: 50px 0;
      padding: 40px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .loading {
      text-align: center;
      color: #667eea;
      font-size: 20px;
      margin: 50px 0;
      padding: 40px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .loading::after {
      content: '';
      width: 30px;
      height: 30px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      display: inline-block;
      margin-left: 10px;
      animation: spin 1s linear infinite;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .stat-number {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin: 30px 0;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-state h3 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .empty-state p {
      color: #666;
      margin-bottom: 20px;
    }
    
    .cta-button {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    @media (max-width: 768px) {
      .search-input {
        width: 100%;
        margin-bottom: 15px;
      }
      
      .search-btn {
        width: 100%;
        margin: 5px 0;
      }
      
      .student-name {
        font-size: 20px;
      }
      
      .clubs-list {
        justify-content: center;
      }
      
      .stats-container {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üìä Club Enrollments Dashboard</h2>
    
    <!-- Statistics Section -->
    <div id="statsContainer" class="stats-container" style="display: none;">
      <div class="stat-card">
        <div class="stat-number" id="totalStudents">0</div>
        <div class="stat-label">üë• Total Students</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalEnrollments">0</div>
        <div class="stat-label">üéØ Total Enrollments</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="activeClubs">0</div>
        <div class="stat-label">üèÜ Active Clubs</div>
      </div>
    </div>
    
    <!-- Search Section -->
    <div class="search-container">
      <div>
        <input type="text" id="searchInput" class="search-input" placeholder="üîç Search by Student ID, Name, or Department">
      </div>
      <div style="margin-top: 15px;">
        <button onclick="searchEnrollments()" class="search-btn">üîç Search</button>
        <button onclick="loadAllEnrollments()" class="search-btn show-all">üìã Show All</button>
        <button onclick="clearSearch()" class="search-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üóëÔ∏è Clear</button>
      </div>
    </div>

    <!-- Enrollments Display -->
    <div id="enrollmentsContainer" class="enrollments-container">
      <div class="loading">üìö Loading enrollments...</div>
    </div>

    <a href="index.html" class="back-btn">‚Üê Back to Home</a>
  </div>

  <script>
    let allEnrollments = [];
    
    // Load all enrollments when page loads
    window.onload = function() {
      loadAllEnrollments();
    };

    async function loadAllEnrollments() {
      const container = document.getElementById('enrollmentsContainer');
      container.innerHTML = '<div class="loading">üìö Loading enrollments...</div>';
      
      try {
        const response = await fetch('php/get_enrollments.php');
        const data = await response.json();
        
        if (response.ok) {
          allEnrollments = data;
          displayEnrollments(data);
          updateStats(data);
        } else {
          throw new Error(data.error || 'Failed to load enrollments');
        }
      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = `
          <div class="no-results">
            <div class="empty-state-icon">‚ùå</div>
            <h3>Error Loading Enrollments</h3>
            <p>Unable to connect to the database. Please try again.</p>
            <button onclick="loadAllEnrollments()" class="cta-button">üîÑ Retry</button>
          </div>
        `;
      }
    }

    async function searchEnrollments() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      const container = document.getElementById('enrollmentsContainer');
      
      if (searchTerm === '') {
        loadAllEnrollments();
        return;
      }
      
      container.innerHTML = '<div class="loading">üîç Searching...</div>';
      
      try {
        const response = await fetch(`php/get_enrollments.php?search=${encodeURIComponent(searchTerm)}`);
        const data = await response.json();
        
        if (response.ok) {
          displayEnrollments(data);
          updateStats(data);
        } else {
          throw new Error(data.error || 'Search failed');
        }
      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = `
          <div class="no-results">
            <div class="empty-state-icon">üîç</div>
            <h3>Search Error</h3>
            <p>Unable to perform search. Please try again.</p>
          </div>
        `;
      }
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      displayEnrollments(allEnrollments);
      updateStats(allEnrollments);
    }

    function displayEnrollments(data) {
      const container = document.getElementById('enrollmentsContainer');
      
      if (!data || data.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <h3>No Enrollments Found</h3>
            <p>There are no students enrolled in clubs yet, or no results match your search.</p>
            <a href="register_student.html" class="cta-button">üë§ Register Student</a>
            <a href="enroll_club.html" class="cta-button" style="margin-left: 10px;">üéØ Enroll in Clubs</a>
          </div>
        `;
        return;
      }
      
      let html = '';
      data.forEach(student => {
        const clubsHtml = student.clubs && student.clubs.length > 0 
          ? student.clubs.map(club => `<span class="club-tag">${getClubEmoji(club)} ${club}</span>`).join('')
          : '<span style="color: #999; font-style: italic;">No clubs enrolled</span>';
        
        html += `
          <div class="student-card">
            <div class="student-info">
              <div class="student-name">
                üë§ ${escapeHtml(student.firstname)} ${escapeHtml(student.lastname)}
              </div>
              <div class="student-details">
                üÜî <strong>Student ID:</strong> ${escapeHtml(student.student_id)}
              </div>
              <div class="student-details">
                üìß <strong>Email:</strong> ${escapeHtml(student.email)}
              </div>
              <div class="student-details">
                üèõÔ∏è <strong>Department:</strong> ${escapeHtml(student.department)}
              </div>
            </div>
            <div class="clubs-section">
              <div class="clubs-title">
                üé≠ Enrolled Clubs ${student.clubs ? `(${student.clubs.length})` : '(0)'}
              </div>
              <div class="clubs-list">
                ${clubsHtml}
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    function updateStats(data) {
      const statsContainer = document.getElementById('statsContainer');
      const totalStudents = data.length;
      let totalEnrollments = 0;
      const clubsSet = new Set();
      
      data.forEach(student => {
        if (student.clubs && student.clubs.length > 0) {
          totalEnrollments += student.clubs.length;
          student.clubs.forEach(club => clubsSet.add(club));
        }
      });
      
      document.getElementById('totalStudents').textContent = totalStudents;
      document.getElementById('totalEnrollments').textContent = totalEnrollments;
      document.getElementById('activeClubs').textContent = clubsSet.size;
      
      // Show stats container with animation
      statsContainer.style.display = 'grid';
      statsContainer.style.opacity = '0';
      setTimeout(() => {
        statsContainer.style.transition = 'opacity 0.5s ease';
        statsContainer.style.opacity = '1';
      }, 100);
    }

    function getClubEmoji(clubName) {
      const emojis = {
        'Dance': 'üíÉ',
        'Music': 'üéµ',
        'Drama': 'üé≠',
        'Sports': '‚öΩ',
        'Photography': 'üì∏',
        'Art': 'üé®'
      };
      return emojis[clubName] || 'üéØ';
    }

    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, function(m) { return map[m]; });
    }

    // Allow search on Enter key press
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchEnrollments();
      }
    });

    // Real-time search (optional - uncomment if you want live search)
    /*
    document.getElementById('searchInput').addEventListener('input', function() {
      const searchTerm = this.value.trim();
      if (searchTerm.length >= 3 || searchTerm.length === 0) {
        setTimeout(searchEnrollments, 300); // Debounced search
      }
    });
    */
  </script>
</body>
</html>